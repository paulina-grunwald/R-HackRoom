---
title: "DPLYR"
author: "Paulina Grunwald - www.R-HackRoom.com"
date: "December 21, 2016"
output: html_document
---

#####MANAGING AND MUNGING DATA IN R USING DPLYR AND TIDYR#####

###1. Using DPLYR in R

Dplyr is a new package which provides a set of tools for efficiently manipulating datasets in R. You can install and then load dplyr from the library.


```{r}
#Install dplyr package
install.packages("dplyr")
```

```{r setup, include=FALSE}
#Load dplyr from the library
library(dplyr)
```

In this example we will use nycflights13 dataset which can be installed from Cran repository.

```{r}
#Install nycflights13 dataset
install.packages("nycflights13", repos='http://cran.us.r-project.org')
```
```{r}
#Load nycflights13 from the library
library("nycflights13")
```

Now we will wrap our dataframe with tbls using special tbl dataframe - tbl_df . Tbl_df is function in dplyr and it used to prevents long table outputs when accidentally calling the data frame. Tbls also shows the size of the dataset () and will display amount of data that will fit in your console.

```{r}
flights <- tbl_df(flights)
#print flights dataframe
flights
```

Now we can check class of flights dataframe:
```{r}
class(flights)
```
As we can see it was converted to tbl_df dataframe.

Now let's take a glimpse() of our data.
```{r}
glimpse(flights)
```
Glimpse() makes it possible to see every column in a data frame. Very useful:)!

Another way we can display dimension of the dataset is to use dim():
```{r}
dim(flights)
```
As we can see the dataset has 19 collumns and 336776 rows.



Dplyr implements the following verbs useful for data manipulation:

* select(): focus on a subset of variables
* filter(): focus on a subset of rows
* mutate(): add new columns
* summarise(): reduce each group to a smaller number of summary statistics
* arrange(): re-order the rows
* group_by 

##1.1 Select chosen columns using select()##

We can select desired columns by typing their name without using Dplyr and select():

```{r}
 flights[,c('dep_delay','arr_time','origin')]
```

We can perform the same operation using dplyr and select() function:

```{r}
select(flights, dep_delay, arr_time, origin)
```

In order to select columns  whose name contains certain character string we need to use following code:

```{r}
select(flights, starts_with("de"))
```
Similar operation can be perform for the columns that end with certain character string:

```{r}
#Select all columns that end with time
select(flights, ends_with("time"))
```

We can also select all columns that contain certain character string:
```{r}
select(flights, contains("_"))
```

```{r}
select(flights, everything())
```


```{r}
select(flights, matches("*dep_*"))
```

```{r}
flights2 <- flights
flights2
colnames(flights2) <- sprintf("x%d", 1:19)
select(flights2, num_range("x", 5:10))

```

```{r}
col <- c("dep_time", "sched_dep_time")
select(flights,one_of(col))
#The same code can we written also using pipe operator
flights %>% select(one_of(col))
```


Instead writing code provided above we can use pipe operator %>%
You can use keboard shorecut for %>%
Mac: Cmd+Shift+M 

Win: Ctrl+Shift+M


Example: dataset_name %>% select(starts_with("dep"))
```{r}
flights %>% select(ends_with("time"))
```

##1.2 Select chosen rows using filter()##

In order to select ther rows from the dataframe you need to use filter(). You can either use %>% or not.
Using %>% the code would look like thus:
dataset_name %>% filter(col1 > X)
dataset_name %>% filter(col1 %in% c("X", "Y"))

You can combain two expressions using comma:
dataset_name %>% filter(col1 > X, col1 %in% c("X", "Y"))

Using filter() we will select all rows form the flights dataframe in which month is equal to 1 (so January)

```{r}
#Selecting all rows in which month is equal to 1 (January)
flights %>% filter(month == 1)
```

We can also write filter our dataframe finding all rows where destination (dest) is equal to the vector ("PHX", "MIA", "LAX")). Dest refers to the column in flights dataframe. It's not necessary to use $ using Dplyr. 

```{r}
flights %>% filter( dest %in% c("PHX", "MIA", "LAX"))
```

Using filter() it is possible to combine mutiple logical expressions. For example we can filter for all the rows in which destination is equal to the vector c("PHX", "MIA", "LAX") and also where month is equal to 1.


```{r}
flights %>% filter(dest %in% c("PHX", "MIA", "LAX", month == 1 ))
```


##1.3 Derive new variables from the dataframe using mutate()##
mutate() function

##1.4 summarize())##
